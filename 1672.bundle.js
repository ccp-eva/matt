"use strict";(self.webpackChunkmatt=self.webpackChunkmatt||[]).push([[1672],{1672:(e,t,o)=>{o.r(t),o.d(t,{default:()=>p});var a=o(6358),n=o(2354),i=o(6486),s=o.n(i),r=o(9965),d=o(7103),c=o(8503),u=o(1489);a.p8.registerPlugin(n._);const p=async({currentSlide:e,previousSlide:t})=>{(0,u.TH)(e,t,[0,0]),data.procedure.sTask={duration:0,knownAnimals:[],unknownAnimals:[],human:"",chicken:void 0,pig:void 0,dog:void 0,sheep:void 0,goldfish:void 0,cow:void 0,rabbit:void 0,cat:void 0,comprehension:{completed:!1,order:s().shuffle(["inner","middle","outer"]),inner:!1,middle:!1,outer:!1}};const o=document.getElementById("link-st-next"),i=document.getElementById("player"),p=document.getElementById("audio"),l=document.getElementById("link-st-headphones"),m=document.getElementById("st-circle"),h=document.getElementById("st-inner"),v=document.getElementById("st-middle"),g=document.getElementById("st-outer");a.p8.to([h,v,g],{opacity:.5});let E=[],y=[];["chicken","pig","dog","sheep","goldfish","cow","rabbit","cat"].forEach((e=>{const t=s().camelCase(`s-${e}`);if(!data.procedure[t])return console.warn(`${e} not found in data.procedure, treating it as unknown.`),void y.push(e);"yes"===data.procedure[t].response.split("-").at(-1)&&E.push(e),"no"===data.procedure[t].response.split("-").at(-1)&&y.push(e)})),data.procedure.sTask.knownAnimals=E,data.procedure.sTask.unknownAnimals=y,E=[...E,"human"];const k=E.map((e=>document.getElementById(`link-st-${e}`))),f=y.map((e=>document.getElementById(`link-st-${e}`)));a.p8.set(f,{autoAlpha:0}),a.p8.set(k,{autoAlpha:.5}),a.p8.set([o,l],{autoAlpha:0,pointerEvents:"none"});let w=!0;i.addEventListener("play",(()=>{w=!0})),p.addEventListener("play",(()=>{w=!0})),i.addEventListener("ended",(()=>{w=!1,a.p8.to(i,{autoAlpha:0})})),p.addEventListener("ended",(()=>{w=!1}));const B=document.getElementById("s-blocking-state");B.removeAttribute("visibility");const A=await fetch(`./cultures/${data.culture}/video/s-task.webm`),L=await A.blob(),b=URL.createObjectURL(L);for(B.setAttribute("visibility","hidden"),i.src=b;w;)await(0,c._v)(100);a.p8.to(k,{autoAlpha:1}),(0,r.hY)(`./cultures/${data.culture}/audio/s-task-cut.mp3`,l.id),a.p8.to(l,{autoAlpha:1,pointerEvents:"visible"});const x=h.getBBox().width/2,$=v.getBBox().width/2,I=g.getBBox().width/2,T=h.getBBox().x+x,M=h.getBBox().y+x,_=n._.create(k,{onPress:function(){console.log(_);let e=this.target.id.slice(8);(0,r.hY)(`./cultures/${data.culture}/audio/st-${e}.mp3`)},onDrag:function(){const e=this.target,t=e.getBBox(),o=e.getBBox().height/2,n=e.getBBox().width/2;let i=t.x+n+this.x,s=t.y+o+this.y;const r=Math.sqrt(Math.pow(i-T,2)+Math.pow(s-M,2));1.2*r<=x+n&&(a.p8.to(h,{opacity:1}),a.p8.to([v,g],{opacity:.5})),1.2*r<=$+n&&1.2*r>x+n&&(a.p8.to(v,{opacity:1}),a.p8.to([h,g],{opacity:.5})),1.2*r<=I+n&&1.2*r>$+n&&(a.p8.to(g,{opacity:1}),a.p8.to([h,v],{opacity:.5}),a.p8.to(this.target,{scale:.5,transformOrigin:"50% 50%"})),1.2*r>I+n&&(a.p8.to(this.target,{scale:1,transformOrigin:"50% 50%"}),a.p8.to([h,v,g],{opacity:.5}))},onDragEnd:function(){const e=this.target,t=e.id;console.log(t);const o=t.slice(8),n=e.getBBox(),i=e.getBBox().height/2,s=e.getBBox().width/2;let r=n.x+s+this.x,d=n.y+i+this.y;const c=Math.sqrt(Math.pow(r-T,2)+Math.pow(d-M,2));1.2*c<=x+s&&(data.procedure.sTask[o]="inner",a.p8.to(h,{opacity:.5,duration:.25})),1.2*c<=$+s&&1.2*c>x+s&&(data.procedure.sTask[o]="middle",a.p8.to(v,{opacity:.5,duration:.25})),1.2*c<=I+s&&1.2*c>$+s&&(data.procedure.sTask[o]="outer",a.p8.to(g,{opacity:.5,duration:.25})),1.2*c>I+s&&a.p8.to(e,{x:0,y:0})}}),C=()=>{let e=[];return E.forEach((t=>{data.procedure.sTask[t]||e.push(!1)})),e},Y=()=>{let e=0;return E.forEach((t=>{data.procedure.sTask[t]&&e++})),e};for(;Y()<Math.ceil(E.length/2);)await(0,c._v)(500);for(console.log("Comprehension check..."),a.p8.to([k,h,v,g],{opacity:.5}),_.forEach((e=>{e.disable()}));w;)await(0,c._v)(100);function q(){a.p8.timeline().to(h,{autoAlpha:1})}function O(){a.p8.timeline().to(h,{autoAlpha:.5})}function P(){a.p8.timeline().to(v,{autoAlpha:1})}function D(){a.p8.timeline().to(v,{autoAlpha:.5})}function R(){a.p8.timeline().to(g,{autoAlpha:1})}function S(){a.p8.timeline().to(g,{autoAlpha:.5})}for(const[e,t]of data.procedure.sTask.comprehension.order.entries()){a.p8.set(l,{opacity:.5,pointerEvents:"none"}),(0,r.hY)(`./cultures/${data.culture}/audio/s-comp-check-${t}.mp3`,l.id),0===e&&await(0,r.bA)(`./cultures/${data.culture}/audio/s-comp-check.mp3`),await(0,r.bA)(`./cultures/${data.culture}/audio/s-comp-check-${t}.mp3`),0===e&&await(0,r.bA)(`./cultures/${data.culture}/audio/s-comp-check-expl.mp3`),a.p8.set(l,{opacity:1,pointerEvents:"visible"}),m.style.cursor="pointer",h.addEventListener("mousemove",q),h.addEventListener("mouseenter",q),h.addEventListener("mouseleave",O),v.addEventListener("mousemove",P),v.addEventListener("mouseenter",P),v.addEventListener("mouseleave",D),g.addEventListener("mousemove",R),g.addEventListener("mouseenter",R),g.addEventListener("mouseleave",S);const o=await(0,d.c)(["st-inner","st-middle","st-outer"]);m.style.cursor="default",h.removeEventListener("mousemove",q),h.removeEventListener("mouseenter",q),h.removeEventListener("mouseleave",O),v.removeEventListener("mousemove",P),v.removeEventListener("mouseenter",P),v.removeEventListener("mouseleave",D),g.removeEventListener("mousemove",R),g.removeEventListener("mouseenter",R),g.removeEventListener("mouseleave",S);const n=["ok","alright","okThanks"],i=n[Math.floor(Math.random()*n.length)];await(0,r.bA)(`./cultures/${data.culture}/audio/neutral-resp-${i}.mp3`),a.p8.to([h,v,g],{autoAlpha:.5}),o.id.slice(3)===t&&(data.procedure.sTask.comprehension[t]=!0)}for(data.procedure.sTask.comprehension.completed=!0,a.p8.to(k,{opacity:1}),_.forEach((e=>{e.enable()}));C().length>0;)await(0,c._v)(1e3);for(a.p8.to([k,h,v,g],{opacity:.5}),_.forEach((e=>{e.disable()})),w=!0,(0,r.hY)(`./cultures/${data.culture}/audio/sqr-next-red.mp3`),a.p8.timeline().to(o,{autoAlpha:.5}).to(o,{filter:"drop-shadow(0px 0px 14px #a90707)",delay:1,repeat:-1,yoyo:!0,reversed:!0});w;)await(0,c._v)(100);a.p8.to(o,{autoAlpha:1,pointerEvents:"visible"}),await(0,d.c)(o.id)}},7103:(e,t,o)=>{o.d(t,{c:()=>a});const a=e=>new Promise((t=>{const o=e=>{const o=e.target;return t(o)};"string"==typeof e&&document.getElementById(e).addEventListener("click",o,{once:!0}),Array.isArray(e)&&e.forEach((e=>{document.getElementById(e).addEventListener("click",o,{once:!0})})),void 0===e&&document.getElementById("wrapper").addEventListener("click",o,{once:!0})}))}}]);